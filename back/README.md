# SubtleGram Backend

AI-powered –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –Ω–∞ –±–∞–∑–µ OpenRouter —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—É–±—Ç–∏—Ç—Ä—ã –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Ñ–∏–ª—å–º–æ–≤/—Å–µ—Ä–∏–∞–ª–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ª–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —è–∑—ã–∫–∞:

- **–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π** —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Å—Ç–∏–ª–µ–π (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π/–¥–æ—Å–ª–æ–≤–Ω—ã–π)
- **–û–±—ä—è—Å–Ω–µ–Ω–∏—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏** –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–ª–µ–Ω–≥–∞** –∏–∑ Urban Dictionary API
- **–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏** –ø–æ —à–∫–∞–ª–µ CEFR (A1-C2)
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑** —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö/—Å–ª–µ–¥—É—é—â–∏—Ö —Ä–µ–ø–ª–∏–∫

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd back
npm install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

#### 1. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á OpenRouter

- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [openrouter.ai](https://openrouter.ai/keys)
- –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á
- **–ú–æ–¥–µ–ª–∏:** –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–∑ —Ç–æ–ø–∞ OpenRouter

#### 2. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
PORT=3001
NODE_ENV=development
OPENROUTER_API_KEY=your_openrouter_api_key_here
FRONTEND_URL=http://localhost:3000

```

### –ó–∞–ø—É—Å–∫

```bash
npm run dev  # —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm start    # –ø—Ä–æ–¥–∞–∫—à–Ω
```

–°–µ—Ä–≤–µ—Ä: `http://localhost:3001`

## üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ controllers/         # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ API
‚îÇ   ‚îú‚îÄ‚îÄ analyzeController.ts   # –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ uploadController.ts    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ routes/              # Express –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ subtitles.ts           # API —Å—É–±—Ç–∏—Ç—Ä–æ–≤ (/api/subtitles/*)
‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ analysisService.ts     # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ openRouterService.ts   # OpenRouter AI –∫–ª–∏–µ–Ω—Ç —Å fallback
‚îÇ   ‚îú‚îÄ‚îÄ slangService.ts        # Urban Dictionary API
‚îÇ   ‚îî‚îÄ‚îÄ subtitleParserService.ts # –ü–∞—Ä—Å–∏–Ω–≥ SRT/VTT/TXT —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ types/               # TypeScript –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ index.ts               # –í—Å–µ —Ç–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.ts              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–µ–π –∏ API
‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.ts        # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ validation.ts          # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ index.ts             # Express —Å–µ—Ä–≤–µ—Ä –∏ middleware
```

## üîß API

### Health Check

```http
GET /health
```

**–û—Ç–≤–µ—Ç:** –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞, timestamp, –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É–±—Ç–∏—Ç—Ä–æ–≤

```http
POST /api/subtitles/upload
Content-Type: multipart/form-data

subtitle: —Ñ–∞–π–ª —Å—É–±—Ç–∏—Ç—Ä–æ–≤
```

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** SRT, VTT, TXT –¥–æ 10MB
**–û—Ç–≤–µ—Ç:** –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

```http
POST /api/subtitles/analyze
Content-Type: application/json

{
  "sentenceText": "I'm here, Ravi.",
  "context": {
    "prev": "Ravi, I need you to go to Major",
    "next": "and find out where the bodies are"
  },
  "seriesName": "The Walking Dead"
}
```

**–ü—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞:**

1. **AI –∞–Ω–∞–ª–∏–∑** - OpenRouter –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
2. **–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞** - –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
3. **–°–ª–µ–Ω–≥** - –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ Urban Dictionary API, –µ—Å–ª–∏ –¥–æ —ç—Ç–æ–≥–æ –±—ã–ª –Ω–∞–π–¥–µ–Ω —Å–ª–µ–Ω–≥
4. **–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏** - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ CEFR —à–∫–∞–ª–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Å—Ç–∏–ª–µ–π
- –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–ª–µ–Ω–≥–æ–≤—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (A1-C2)
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å

### Health Check —Å–µ—Ä–≤–∏—Å–∞

```http
GET /api/subtitles/health
```

**–û—Ç–≤–µ—Ç:** –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ AI –º–æ–¥–µ–ª–µ–π, –ª–∏–º–∏—Ç–∞—Ö, —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã

```bash
npm run dev               # —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
npm run build             # —Å–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm start                 # –∑–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
npm run test-integration  # –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º
npm run test-ud-api       # —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Urban Dictionary API
npm run lint              # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
npm run type-check        # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è           | –û–ø–∏—Å–∞–Ω–∏–µ             | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é            |
| -------------------- | -------------------- | ----------------------- |
| `PORT`               | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞         | `3001`                  |
| `OPENROUTER_API_KEY` | OpenRouter API —Ç–æ–∫–µ–Ω | _–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ_           |
| `FRONTEND_URL`       | URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞        | `http://localhost:3000` |
| `NODE_ENV`           | –°—Ä–µ–¥–∞                | `development`           |

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Rate limiting (100 –∑–∞–ø—Ä–æ—Å–æ–≤/15–º–∏–Ω)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (SRT, VTT, TXT –¥–æ 10MB)
- CORS –∑–∞—â–∏—Ç–∞
- Helmet.js HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm run test-integration  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –º–æ–∫–∞–º–∏ AI
npm run test-ud-api       # –¢–µ—Å—Ç—ã Urban Dictionary API
npm run type-check        # –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript —Ç–∏–ø–æ–≤
npm run lint              # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**

- –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Urban Dictionary API
- Fallback –º–µ–∂–¥—É AI –º–æ–¥–µ–ª—è–º–∏
- –ü–∞—Ä—Å–∏–Ω–≥ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ rate limiting

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Node.js + Express.js** - REST API —Å–µ—Ä–≤–µ—Ä —Å middleware
- **TypeScript** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π JS
- **OpenRouter API** - AI –º–æ–¥–µ–ª–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback
- **Urban Dictionary API** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–ª–µ–Ω–≥–∞ –∏ –∏–¥–∏–æ–º
- **Multer** - –ø–∞—Ä—Å–∏–Ω–≥ multipart/form-data —Ñ–∞–π–ª–æ–≤
- **Express Rate Limit** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ API
- **CORS + Helmet.js** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
