# SubtleGram Backend

AI-powered –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –Ω–∞ –±–∞–∑–µ OpenRouter (Qwen/GPT –º–æ–¥–µ–ª–µ–π).

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—É–±—Ç–∏—Ç—Ä—ã –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—Ç—å:
- **–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è**
- **–û–±—ä—è—Å–Ω–µ–Ω–∏—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏** –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Å–ª–µ–Ω–≥–∞** –∏–∑ Urban Dictionary
- **–£—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏** (B1, C1 –∏ —Ç.–¥.)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
cd back
npm install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

#### 1. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á OpenRouter
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [openrouter.ai](https://openrouter.ai/keys)
- –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á
- **–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å:** `mistral/mistral-small-3.2-24b-instruct:free` (mistral-small-3.2-24b-instruct)
- **–†–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å:** `openai/gpt-oss-20b:free` (GPT-OSS 20B)

#### 2. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:
```env
PORT=3001
NODE_ENV=development
OPENROUTER_API_KEY=your_openrouter_api_key_here
FRONTEND_URL=http://localhost:3000

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
HF_TOKEN=your_hugging_face_token_here
```

### –ó–∞–ø—É—Å–∫
```bash
npm run dev  # —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm start    # –ø—Ä–æ–¥–∞–∫—à–Ω
```

–°–µ—Ä–≤–µ—Ä: `http://localhost:3001`

## üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ controllers/         # –û–±—Ä–∞–±–æ—Ç–∫–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ uploadController.ts    # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ analyzeController.ts   # –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ –∫–ª–∏–∫—É
‚îú‚îÄ‚îÄ routes/              # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ subtitles.ts           # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å—É–±—Ç–∏—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ openRouterService.ts   # –ö–ª–∏–µ–Ω—Ç OpenRouter AI (—Å fallback)
‚îÇ   ‚îú‚îÄ‚îÄ analysisService.ts     # –õ–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ slangService.ts        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Urban Dictionary
‚îú‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config.ts              # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ validation.ts          # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ types/               # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îî‚îÄ‚îÄ index.ts               # –í—Å–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤
‚îî‚îÄ‚îÄ index.ts             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Express —Å–µ—Ä–≤–µ—Ä–∞
```

## üîß API

### Health Check
```http
GET /health
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É–±—Ç–∏—Ç—Ä–æ–≤
```http
POST /api/subtitles/upload
Content-Type: multipart/form-data

file: subtitle.srt
```

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** SRT, VTT, TXT —Ñ–∞–π–ª—ã –¥–æ 10MB

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
```http
POST /api/subtitles/analyze
Content-Type: application/json

{
  "subtitles": [...],  // –º–∞—Å—Å–∏–≤ —Å—É–±—Ç–∏—Ç—Ä–æ–≤
  "sentenceText": "I gotta go home now.",  // —Ç–µ–∫—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
  "context": {         // –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    "prev": "Hello there",
    "next": "See you later"
  }
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. **–ê–Ω–∞–ª–∏–∑ AI** - Qwen –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
2. **–°–ª–µ–Ω–≥** - –∏–∑–≤–ª–µ–∫–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–∑ Urban Dictionary
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ç–æ–≥–æ –∂–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–ü–µ—Ä–µ–≤–æ–¥** –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ü–µ–ª–∏–∫–æ–º
- **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ** –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ –∏ —Å–ª–µ–Ω–≥–∞
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** —Å–ª–µ–Ω–≥–∞ –∏–∑ Urban Dictionary
- **–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏** (B1, C1 –∏ —Ç.–¥.)

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã

```bash
npm run dev               # —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
npm run build             # —Å–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm start                 # –∑–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
npm run test-integration  # –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º
npm run test-ud-api       # —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Urban Dictionary API
npm run lint              # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
npm run type-check        # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|-------------|
| `PORT` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ | `3001` |
| `OPENROUTER_API_KEY` | OpenRouter API —Ç–æ–∫–µ–Ω | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* |
| `FRONTEND_URL` | URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ | `http://localhost:3000` |
| `NODE_ENV` | –°—Ä–µ–¥–∞ | `development` |

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Rate limiting (100 –∑–∞–ø—Ä–æ—Å–æ–≤/15–º–∏–Ω)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (SRT, VTT, TXT –¥–æ 10MB)
- CORS –∑–∞—â–∏—Ç–∞
- Helmet.js HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm run test-integration  # —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
npm run test-ud-api       # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Urban Dictionary
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Urban Dictionary API
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –∏ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Node.js + Express** - API —Å–µ—Ä–≤–µ—Ä
- **TypeScript** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **OpenRouter API** - AI –∞–Ω–∞–ª–∏–∑ —Å Qwen/GPT –º–æ–¥–µ–ª—è–º–∏
- **Urban Dictionary API** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–ª–µ–Ω–≥–∞
- **Multer** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- **Rate limiting + CORS + Helmet** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
